------------------------------------------------------------------------

**\[로또축구단\] 매치 엔진 설계 보완 및 심화 문서 (v2.0)**

본 문서는 기존 설계안에 대한 전문가 피드백을 반영하여, 시스템의
안정성(안전 코딩)과 실제 구현의 효율성(AI 최적화), 그리고 게임의
재미(전략적 깊이)를 극대화한 심화 설계안입니다.

**1. 실시간 능력치 보정 시스템 (Refined State Modifier)**

선수의 기량은 체력과 호흡뿐만 아니라 실시간 \'팀 사기\'에 의해
결정됩니다 ^1^.

- 통합 보정 공식:

\$Stat\_{Current} = (Stat\_{Base} \\times \\text{상태 지수}) \\times
Morale\_{mod}\$

- **상태 지수:** \$0.5 + 0.5 \\times \\frac{Stamina +
  Breath}{Max\_{Total}}\$ (체력 고갈 시 기량 50% 감소) ^2222^

- **사기 보정 (\$Morale\_{mod}\$):** 경기 상황(득점, 실점 등)에 따라
  0.95 \~ 1.05 사이의 가중치 적용.

**2. 슈팅 및 득점 로직 고도화 (\$P\_{Goal}\$)**

상대평가 모델을 유지하되, \'힘\' 능력치의 역할을 재정의하고 방어 코딩을
추가합니다.

**\[1단계\] 슈팅 퀄리티 (\$Q\_{shot}\$) 및 거리 감쇠**

- **공식:** \$Q\_{shot} = \\frac{(\\text{슛 정확도} \\times 0.6 +
  \\text{침착성} \\times 0.4) \\times \\text{약발
  보정}}{Mathf.Max(Distance\_{decay}, 0.1) \\times Mathf.Max(Pressure,
  1.0)}\$ ^333333^

- **거리 감쇠 (\$Distance\_{decay}\$) 기준:**

  - 0\~10m: 1.0 (감쇠 없음)

  - 11\~25m: 선형 감쇠 (거리 비례)

  - 26m\~40m: 지수 감쇠 (득점 확률 급감)

- **방어 코딩:** 분모가 0이 되는 것을 방지하기 위해 최솟값을 설정합니다.

**\[2단계\] 골키퍼 방어 관통 (\$GK\_{eff}\$)**

\'힘\' 능력치는 키퍼의 방어력을 일정 부분 무시하는 \'관통\' 효과를
가집니다^4444^.

- **수정된 키퍼 방어력:** \$GK\_{eff} = (GK\_{반사신경} \\times 0.8 +
  GK\_{위치선정} \\times 0.2) \\times (1.0 - \\frac{\\text{슈팅 선수의
  힘}}{200})\$

- **최종 판정:** \$P\_{Goal} = \\frac{Q\_{shot}\^2}{Q\_{shot}\^2 +
  GK\_{eff}\^2} + \\text{Random}(-0.1 \\sim 0.1)\$

**3. 패스 및 트래핑 로직 분리 (\$P\_{Pass}\$)**

AI 행동 트리 최적화를 위해 패스 실행과 도달 후 처리를 분리합니다.

- **패스 실행 (성공률):** \$P\_{Pass} = \\frac{(\\text{패스} \\times
  0.7 + \\text{판단력} \\times 0.3)}{\\text{거리 가중치}}\$ ^555^

- **트래핑 판정 (소유권 유지):** 공이 도달한 직후 받는 선수의 \'퍼스트
  터치\' 수치로 판정^6^.

  - 판정 실패 시 공이 발밑에서 튕겨 나가며, 주변 선수의 \'적극성\'
    수치를 기반으로 한 재경합 발생^77^.

**4. 물리 경합 및 태클 (\$P\_{Duel}\$)**

- **공식:** \$P\_{Duel} = \\frac{(\\text{힘} \\times \\text{피지컬
  가중치}) + \\text{적극성}}{(\\text{상대 힘} \\times \\text{상대 피지컬
  가중치}) + \\text{상대 적극성}}\$ ^8888^

- **적용:** 공중볼 경합, 1:1 드리블 돌파 시 사용^9^.

**5. 구현 및 최적화 가이드**

- **확률 제한:** 모든 판정은 최소 1%, 최대 99%의 범위를 유지하여
  \'로또\' 같은 이변 가능성을 열어둡니다.

- **차기 과제 (MatchController):** 위 공식들을 호출하는 우선순위 및 행동
  트리(Decision Tree) 설계 예정.

------------------------------------------------------------------------
